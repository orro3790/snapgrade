import{l as ie,d as H,e as A,a as C,t as j,s as T,c as X}from"../chunks/D4jsaATV.js";import{i as de}from"../chunks/C-o7H_Gu.js";import{at as re,G as se,u as le,r as ce,W as ve,au as $,av as ue,p as O,ac as z,b as G,g as v,n as x,z as D,o as m,m as V,k as Y,s as I,t as M,i as R}from"../chunks/DNffOxin.js";import{o as fe}from"../chunks/BhWNp_XI.js";import{a as xe,p as Z,i as q,s as ee,b as F}from"../chunks/CPXIdTNr.js";import{r as me,s as he,c as ye,t as _e,e as ge}from"../chunks/CV9svu35.js";import{b as we}from"../chunks/dq5qKGfj.js";function Se(t,e,l=e){var f=re();ie(t,"input",_=>{var n=_?t.defaultValue:t.value;if(n=J(t)?Q(n):n,l(n),f&&n!==(n=e())){var a=t.selectionStart,o=t.selectionEnd;t.value=n??"",o!==null&&(t.selectionStart=a,t.selectionEnd=Math.min(o,t.value.length))}}),(se&&t.defaultValue!==t.value||le(e)==null&&t.value)&&l(J(t)?Q(t.value):t.value),ce(()=>{var _=e();J(t)&&_===Q(t.value)||t.type==="date"&&!_&&!t.value||_!==t.value&&(t.value=_??"")})}function J(t){var e=t.type;return e==="number"||e==="range"}function Q(t){return t===""?null:+t}function ke(){const{subscribe:t,update:e}=$({nodeList:[],activeNodeId:null,undoStack:[],redoStack:[],isSaving:!1,lastSavedContent:"",initialState:null});function l(n){return{...n,undoStack:[...n.undoStack,n.nodeList],redoStack:[]}}function f(n,a){const o=[];let r=a;const i=[];let d;const b=/(\S+)\s+!([^!]+)!/g;for(;(d=b.exec(n))!==null;)i.push({type:"correction",text:d[1],correction:d[2],index:d.index,length:d[0].length});const h=/-([^-]+)-/g;for(;(d=h.exec(n))!==null;)i.push({type:"deletion",text:d[1],index:d.index,length:d[0].length});const y=/\[([^\]]+)\]/g;for(;(d=y.exec(n))!==null;)i.push({type:"addition",text:d[1],index:d.index,length:d[0].length});i.sort((s,p)=>s.index-p.index);let w=0;const S=s=>{const p=s.split(/(\s+)|([.,!?;:])/).filter(Boolean);for(const k of p)if(/^\s+$/.test(k))r+=k.length;else{const g=/^[.,!?;:]$/.test(k);o.push({id:crypto.randomUUID(),text:k,type:"normal",startIndex:r,endIndex:r+k.length,isPunctuation:g,mispunctuation:!1}),r+=k.length}};for(const s of i){if(s.index>w){const k=n.slice(w,s.index);S(k)}const p={id:crypto.randomUUID(),text:s.text,type:s.type,startIndex:r,endIndex:r+s.text.length,isPunctuation:!1};s.type==="correction"&&s.correction&&(p.correctionText=s.correction,p.hasNextCorrection=!1),o.push(p),r+=s.length,w=s.index+s.length}if(w<n.length){const s=n.slice(w);S(s)}for(let s=0;s<o.length-1;s++)o[s].type==="correction"&&o[s+1].type==="correction"&&(o[s].hasNextCorrection=!0),o[s].type==="correction"&&o[s+1].isPunctuation&&(o[s].hasNextCorrection=!0);return o}return{subscribe:t,parseContent:n=>{const a=n.split(`

`).map((o,r)=>({id:crypto.randomUUID(),nodes:f(o,r*1e3),originalText:o}));e(o=>({...o,nodeList:a,lastSavedContent:n,initialState:o.initialState===null?a:o.initialState}))},insertNodeAfter:(n,a,o="normal")=>{e(r=>{const i=l(r);let d=-1;const b=r.nodeList.find(w=>(d=w.nodes.findIndex(S=>S.id===n),d!==-1));if(!b||d===-1)return r;const h={id:crypto.randomUUID(),text:a,type:o,startIndex:b.nodes[d].endIndex+1,endIndex:b.nodes[d].endIndex+1+a.length,isPunctuation:!1},y=r.nodeList.map(w=>{if(w.id===b.id){const S=[...w.nodes];return S.splice(d+1,0,h),{...w,nodes:S}}return w});return{...i,nodeList:y,activeNodeId:h.id}})},removeNode:n=>{e(a=>{const o=l(a),r=a.nodeList.map(i=>({...i,nodes:i.nodes.filter(d=>d.id!==n)})).filter(i=>i.nodes.length>0);return{...o,nodeList:r,activeNodeId:a.activeNodeId===n?null:a.activeNodeId}})},updateNode:(n,a,o,r)=>{e(i=>{const d=l(i),b=i.nodeList.map(h=>({...h,nodes:h.nodes.map(y=>y.id===n?{...y,text:a,type:r||y.type,...o!==void 0&&{correctionText:o}}:y)}));return{...d,nodeList:b}})},setActiveNode:n=>{e(a=>({...a,activeNodeId:n}))},undo:()=>{e(n=>{if(n.undoStack.length===0)return n;const a=[...n.undoStack],o=a.pop();return{...n,nodeList:o,undoStack:a,redoStack:[...n.redoStack,n.nodeList]}})},redo:()=>{e(n=>{if(n.redoStack.length===0)return n;const a=[...n.redoStack],o=a.pop();return{...n,nodeList:o,undoStack:[...n.undoStack,n.nodeList],redoStack:a}})},getContent:()=>ve({subscribe:t}).nodeList.map(a=>a.nodes.map(o=>{switch(o.type){case"deletion":return`-${o.text}-`;case"addition":return`[${o.text}]`;case"correction":return`${o.text} !${o.correctionText}!`;default:return o.text}}).join(" ")).join(`

`)}}const u=ke(),be=$({isOpen:!0}),te=$(null),pe=ue(u,t=>{const e={total:0,deletions:0,additions:0,corrections:0,normal:0};return t.nodeList.forEach(l=>{l.nodes.forEach(f=>{switch(e.total++,f.type){case"deletion":e.deletions++;break;case"addition":e.additions++;break;case"correction":e.corrections++;break;case"normal":e.normal++;break}})}),e});function Ne(t,e){(t.key==="Enter"||t.key==="Escape")&&(t.preventDefault(),e())}var Ce=j('<div class="modal-overlay svelte-qx9pm6" role="dialog" aria-modal="true" aria-label="Edit text modal" tabindex="-1"><div class="modal-content svelte-qx9pm6" role="document"><input class="edit-input svelte-qx9pm6" aria-label="Edit text" type="text"></div></div>');function Ie(t,e){O(e,!0);let l=z(xe(e.node.text)),f=z(void 0),_=z(!1);G(()=>{v(f)&&(v(f).focus(),v(f).select())});function n(){if(v(_))return;D(_,!0);const i=v(l).trim();try{if(e.node.type==="empty"){i?u.updateNode(e.node.id,i,void 0,"addition"):u.removeNode(e.node.id);return}if(!i||i===e.node.text){i||u.updateNode(e.node.id,e.node.text,void 0,"normal");return}if(i.startsWith("`"))u.updateNode(e.node.id,e.node.text,void 0,"deletion");else if(i.startsWith("@")){const d=i.slice(1);d&&(u.updateNode(e.node.id,e.node.text),u.insertNodeAfter(e.node.id,d))}else if(i.startsWith("!")){const d=i.slice(1);d!==e.node.text&&u.updateNode(e.node.id,d)}else u.updateNode(e.node.id,e.node.text,i,"correction")}finally{D(_,!1),e.onClose()}}var a=Ce(),o=x(a),r=x(o);me(r),r.__keydown=[Ne,n],we(r,i=>D(f,i),()=>v(f)),m(o),m(a),A("blur",r,n),Se(r,()=>v(l),i=>D(l,i)),C(t,a),V()}H(["keydown"]);function Ee(t,e){if(t.preventDefault(),t.ctrlKey&&t.button===2)return u.removeNode(e.node.id),!1}function Le(t,e,l,f){if(t.key==="`"&&!v(e)){t.preventDefault(),u.updateNode(l.node.id,l.node.text,void 0,"deletion");return}t.key==="Enter"&&(t.ctrlKey?f(new MouseEvent("click",{ctrlKey:!0})):D(e,!0)),t.key==="Delete"&&t.ctrlKey&&u.removeNode(l.node.id)}var Te=j('<div class="correction-wrapper svelte-1ds3l31"><div class="correction-text svelte-1ds3l31"> </div> <div class="text-content svelte-1ds3l31"> </div></div>'),De=j('<div class="text-content deleted svelte-1ds3l31"> </div>'),je=j('<div class="text-content svelte-1ds3l31">+</div>'),Ke=j('<div class="text-content svelte-1ds3l31"> </div>'),Ae=j('<div role="button" tabindex="0"><!></div> <!>',1);function Ue(t,e){O(e,!0);const[l,f]=ee(),_=()=>F(te,"$hoveredNodeType",l),n=Z(e,"isActive",3,!1);let a=z(!1),o=z(!1);function r(g){if(g.button===0){if(g.ctrlKey){u.insertNodeAfter(e.node.id,"","empty");return}if(g.altKey){if(e.node.type==="empty")return;e.node.type==="deletion"?u.updateNode(e.node.id,e.node.text,void 0,"normal"):u.updateNode(e.node.id,e.node.text,void 0,"deletion");return}if(e.node.type==="deletion"){u.updateNode(e.node.id,e.node.text,void 0,"normal");return}u.setActiveNode(e.node.id),n()&&D(a,!0)}}function i(){D(o,!0),setTimeout(()=>{D(o,!1)},300)}function d(){D(a,!1),u.setActiveNode(null),i()}let b=R(()=>["text-node",e.node.type,n()?"active":"",e.node.hasNextCorrection?"has-next-correction":"",v(a)?"highlighted":"",e.node.isPunctuation?"punctuation":"",v(o)?"saved-flash":"",_()===e.node.type?`highlight-${e.node.type}`:""].filter(Boolean).join(" "));var h=Ae(),y=Y(h);y.__click=r,y.__contextmenu=[Ee,e],y.__keydown=[Le,a,e,r];var w=x(y);{var S=g=>{var E=Te(),c=x(E),K=x(c,!0);m(c);var U=I(c,2),N=x(U,!0);m(U),m(E),M(()=>{T(K,e.node.correctionText),T(N,e.node.text)}),C(g,E)},s=g=>{var E=X(),c=Y(E);{var K=N=>{var L=De(),W=x(L,!0);m(L),M(()=>T(W,e.node.text)),C(N,L)},U=N=>{var L=X(),W=Y(L);{var ne=P=>{var B=je();C(P,B)},oe=P=>{var B=Ke(),ae=x(B,!0);m(B),M(()=>T(ae,e.node.text)),C(P,B)};q(W,P=>{e.node.type==="empty"?P(ne):P(oe,!1)},!0)}C(N,L)};q(c,N=>{e.node.type==="deletion"?N(K):N(U,!1)},!0)}C(g,E)};q(w,g=>{e.node.type==="correction"?g(S):g(s,!1)})}m(y);var p=I(y,2);{var k=g=>{Ie(g,{get node(){return e.node},onClose:d})};q(p,g=>{v(a)&&g(k)})}M(()=>he(y,ye(v(b)),"svelte-1ds3l31")),C(t,h),V(),f()}H(["click","contextmenu","keydown"]);var Pe=(t,e)=>e(t,"correction"),Me=(t,e)=>e(t,"deletion"),Re=(t,e)=>e(t,"addition"),We=j('<div class="stats-container svelte-1e0jo2r" role="complementary" aria-label="Document statistics"><div class="stat svelte-1e0jo2r"><span class="label svelte-1e0jo2r">Total:</span> <span class="value svelte-1e0jo2r"> </span></div> <div class="stat svelte-1e0jo2r" role="button" tabindex="0" aria-label="Show correction annotations"><span class="label svelte-1e0jo2r">Corrections:</span> <span class="value svelte-1e0jo2r"> </span></div> <div class="stat svelte-1e0jo2r" role="button" tabindex="0" aria-label="Show deletion annotations"><span class="label svelte-1e0jo2r">Deletions:</span> <span class="value svelte-1e0jo2r"> </span></div> <div class="stat svelte-1e0jo2r" role="button" tabindex="0" aria-label="Show addition annotations"><span class="label svelte-1e0jo2r">Additions:</span> <span class="value svelte-1e0jo2r"> </span></div></div>');function Be(t,e){O(e,!0);const[l,f]=ee();let n=R(()=>F(pe,"$statsStore",l));function a(c){te.set(c)}function o(c,K){(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),a(K))}var r=We(),i=x(r),d=I(x(i),2),b=x(d,!0);m(d),m(i);var h=I(i,2);h.__keydown=[Pe,o];var y=I(x(h),2),w=x(y,!0);m(y),m(h);var S=I(h,2);S.__keydown=[Me,o];var s=I(x(S),2),p=x(s,!0);m(s),m(S);var k=I(S,2);k.__keydown=[Re,o];var g=I(x(k),2),E=x(g,!0);m(g),m(k),m(r),M(()=>{T(b,v(n).total),T(w,v(n).corrections),T(p,v(n).deletions),T(E,v(n).additions)}),A("mouseenter",h,()=>a("correction")),A("mouseleave",h,()=>a(null)),A("mouseenter",S,()=>a("deletion")),A("mouseleave",S,()=>a(null)),A("mouseenter",k,()=>a("addition")),A("mouseleave",k,()=>a(null)),C(t,r),V(),f()}H(["keydown"]);var qe=j('<div class="editor-wrapper svelte-r2y84x" tabindex="-1" aria-multiline="true" aria-label="Text editor content" role="textbox"><!> <div class="main-content svelte-r2y84x"><div class="preview-container svelte-r2y84x" role="complementary" aria-label="Preview"><div class="a4-content svelte-r2y84x"> <div class="line-row svelte-r2y84x"><!></div></div></div></div></div>');function ze(t,e){O(e,!0);const[l,f]=ee(),_=()=>F(u,"$editorStore",l),n=()=>F(be,"$sidebarStore",l),a=Z(e,"initialContent",3,""),o=Z(e,"onContentChange",3,c=>{});let r=R(()=>_().nodeList),i=R(()=>_().activeNodeId),d=R(()=>u.getContent());G(()=>{a()&&!v(d)&&u.parseContent(a())}),G(()=>{v(d)!==a()&&o()(v(d))});function b(c){c.ctrlKey&&c.key==="z"&&!c.shiftKey?(c.preventDefault(),u.undo()):c.ctrlKey&&c.key==="y"&&(c.preventDefault(),u.redo())}G(()=>{u.getContent(),_().lastSavedContent});var h=qe();h.__keydown=b;var y=x(h);Be(y,{});var w=I(y,2),S=x(w),s=x(S),p=x(s),k=I(p),g=x(k);{var E=c=>{var K=X(),U=Y(K);ge(U,17,()=>v(r)[0].nodes,N=>N.id,(N,L)=>{const W=R(()=>v(L).id===v(i));Ue(N,{get node(){return v(L)},get isActive(){return v(W)}})}),C(c,K)};q(g,c=>{v(r).length>0&&c(E)})}m(k),m(s),m(S),m(w),m(h),M(c=>{_e(w,"sidebar-expanded",n().isOpen),T(p,`${c??""} `)},[()=>console.log(v(r))]),C(t,h),V(),f()}H(["keydown"]);var Oe=j('<div class="app-container svelte-15pewon"><!></div>');function Xe(t,e){O(e,!1);const l="Me and my friend go to school in Busan.  We learn many thing, like English and math.  Sometimes, English is very difficult, but I try my bestest.  After school, we play soccer and eat kimchi with my family.";let f=!1;const _=i=>{if(f)return i.preventDefault(),""},n=i=>{f&&!window.confirm("You have unsaved changes. Are you sure you want to leave?")&&(i.preventDefault(),history.pushState(null,"",window.location.href))};fe(()=>(window.addEventListener("beforeunload",_),window.addEventListener("popstate",n),history.pushState(null,"",window.location.href),()=>{window.removeEventListener("beforeunload",_),window.removeEventListener("popstate",n)}));function a(i){f=i!==l}de();var o=Oe(),r=x(o);ze(r,{initialContent:l,onContentChange:a}),m(o),C(t,o),V()}export{Xe as component};
