import{l as ie,e as Y,f as U,a as C,t as K,s as T,c as Q}from"../chunks/QQHAoa1N.js";import{i as de}from"../chunks/DTrNxt7t.js";import{aG as re,G as se,u as le,r as ce,W as ve,aH as $,aI as ue,p as G,av as z,b as X,g as v,n as f,z as D,o as m,m as O,k as V,s as I,t as R,i as W}from"../chunks/Zk5odD6z.js";import{o as fe}from"../chunks/BhI9vWAV.js";import{a as me,p as Z,i as q,s as ee,b as H}from"../chunks/DNMqTQGj.js";import{r as xe,s as he,c as ye,t as _e,e as we}from"../chunks/BO3XGq7D.js";import{b as ge}from"../chunks/B-dNp7l6.js";function Se(t,e,l=e){var u=re();ie(t,"input",w=>{var n=w?t.defaultValue:t.value;if(n=F(t)?J(n):n,l(n),u&&n!==(n=e())){var a=t.selectionStart,o=t.selectionEnd;t.value=n??"",o!==null&&(t.selectionStart=a,t.selectionEnd=Math.min(o,t.value.length))}}),(se&&t.defaultValue!==t.value||le(e)==null&&t.value)&&l(F(t)?J(t.value):t.value),ce(()=>{var w=e();F(t)&&w===J(t.value)||t.type==="date"&&!w&&!t.value||w!==t.value&&(t.value=w??"")})}function F(t){var e=t.type;return e==="number"||e==="range"}function J(t){return t===""?null:+t}function ke(){const{subscribe:t,update:e}=$({nodeList:[],activeNodeId:null,undoStack:[],redoStack:[],isSaving:!1,lastSavedContent:"",initialState:null});function l(n){return{...n,undoStack:[...n.undoStack,n.nodeList],redoStack:[]}}function u(n,a){const o=[];let r=a;const i=[];let d;const b=/(\S+)\s+!([^!]+)!/g;for(;(d=b.exec(n))!==null;)i.push({type:"correction",text:d[1],correction:d[2],index:d.index,length:d[0].length});const h=/-([^-]+)-/g;for(;(d=h.exec(n))!==null;)i.push({type:"deletion",text:d[1],index:d.index,length:d[0].length});const y=/\[([^\]]+)\]/g;for(;(d=y.exec(n))!==null;)i.push({type:"addition",text:d[1],index:d.index,length:d[0].length});i.sort((s,p)=>s.index-p.index);let g=0;const S=s=>{const p=s.split(/(\s+)|([.,!?;:])/).filter(Boolean);for(const k of p)if(/^\s+$/.test(k))r+=k.length;else{const _=/^[.,!?;:]$/.test(k);o.push({id:crypto.randomUUID(),text:k,type:"normal",startIndex:r,endIndex:r+k.length,isPunctuation:_,mispunctuation:!1}),r+=k.length}};for(const s of i){if(s.index>g){const k=n.slice(g,s.index);S(k)}const p={id:crypto.randomUUID(),text:s.text,type:s.type,startIndex:r,endIndex:r+s.text.length,isPunctuation:!1};s.type==="correction"&&s.correction&&(p.correctionText=s.correction,p.hasNextCorrection=!1),o.push(p),r+=s.length,g=s.index+s.length}if(g<n.length){const s=n.slice(g);S(s)}for(let s=0;s<o.length-1;s++)o[s].type==="correction"&&o[s+1].type==="correction"&&(o[s].hasNextCorrection=!0),o[s].type==="correction"&&o[s+1].isPunctuation&&(o[s].hasNextCorrection=!0);return o}return{subscribe:t,parseContent:n=>{const a=n.split(`

`).map((o,r)=>({id:crypto.randomUUID(),nodes:u(o,r*1e3),originalText:o}));e(o=>({...o,nodeList:a,lastSavedContent:n,initialState:o.initialState===null?a:o.initialState}))},insertNodeAfter:(n,a,o="normal")=>{e(r=>{const i=l(r);let d=-1;const b=r.nodeList.find(g=>(d=g.nodes.findIndex(S=>S.id===n),d!==-1));if(!b||d===-1)return r;const h={id:crypto.randomUUID(),text:a,type:o,startIndex:b.nodes[d].endIndex+1,endIndex:b.nodes[d].endIndex+1+a.length,isPunctuation:!1},y=r.nodeList.map(g=>{if(g.id===b.id){const S=[...g.nodes];return S.splice(d+1,0,h),{...g,nodes:S}}return g});return{...i,nodeList:y,activeNodeId:h.id}})},removeNode:n=>{e(a=>{const o=l(a),r=a.nodeList.map(i=>({...i,nodes:i.nodes.filter(d=>d.id!==n)})).filter(i=>i.nodes.length>0);return{...o,nodeList:r,activeNodeId:a.activeNodeId===n?null:a.activeNodeId}})},updateNode:(n,a,o,r)=>{e(i=>{const d=l(i),b=i.nodeList.map(h=>({...h,nodes:h.nodes.map(y=>y.id===n?{...y,text:a,type:r||y.type,...o!==void 0&&{correctionText:o}}:y)}));return{...d,nodeList:b}})},setActiveNode:n=>{e(a=>({...a,activeNodeId:n}))},undo:()=>{e(n=>{if(n.undoStack.length===0)return n;const a=[...n.undoStack],o=a.pop();return{...n,nodeList:o,undoStack:a,redoStack:[...n.redoStack,n.nodeList]}})},redo:()=>{e(n=>{if(n.redoStack.length===0)return n;const a=[...n.redoStack],o=a.pop();return{...n,nodeList:o,undoStack:[...n.undoStack,n.nodeList],redoStack:a}})},getContent:()=>ve({subscribe:t}).nodeList.map(a=>a.nodes.map(o=>{switch(o.type){case"deletion":return`-${o.text}-`;case"addition":return`[${o.text}]`;case"correction":return`${o.text} !${o.correctionText}!`;default:return o.text}}).join(" ")).join(`

`)}}const x=ke(),be=$({isOpen:!0}),te=$(null),pe=ue(x,t=>{const e={total:0,deletions:0,additions:0,corrections:0,normal:0};return t.nodeList.forEach(l=>{l.nodes.forEach(u=>{switch(e.total++,u.type){case"deletion":e.deletions++;break;case"addition":e.additions++;break;case"correction":e.corrections++;break;case"normal":e.normal++;break}})}),e});function Ne(t,e){(t.key==="Enter"||t.key==="Escape")&&(t.preventDefault(),e())}var Ce=K('<div class="modal-overlay svelte-qx9pm6" role="dialog" aria-modal="true" aria-label="Edit text modal" tabindex="-1"><div class="modal-content svelte-qx9pm6" role="document"><input class="edit-input svelte-qx9pm6" aria-label="Edit text" type="text"></div></div>');function Ie(t,e){G(e,!0);let l=z(me(e.node.text)),u=z(void 0),w=z(!1);X(()=>{v(u)&&(v(u).focus(),v(u).select())});function n(){if(v(w))return;D(w,!0);const i=v(l).trim();try{if(e.node.type==="empty"){i?x.updateNode(e.node.id,i,void 0,"addition"):x.removeNode(e.node.id);return}if(!i||i===e.node.text){i||x.updateNode(e.node.id,e.node.text,void 0,"normal");return}if(i.startsWith("`"))x.updateNode(e.node.id,e.node.text,void 0,"deletion");else if(i.startsWith("@")){const d=i.slice(1);d&&(x.updateNode(e.node.id,e.node.text),x.insertNodeAfter(e.node.id,d))}else if(i.startsWith("!")){const d=i.slice(1);d!==e.node.text&&x.updateNode(e.node.id,d)}else x.updateNode(e.node.id,e.node.text,i,"correction")}finally{D(w,!1),e.onClose()}}var a=Ce(),o=f(a),r=f(o);xe(r),r.__keydown=[Ne,n],ge(r,i=>D(u,i),()=>v(u)),m(o),m(a),U("blur",r,n),Se(r,()=>v(l),i=>D(l,i)),C(t,a),O()}Y(["keydown"]);function Ee(t,e){if(t.preventDefault(),t.ctrlKey&&t.button===2)return x.removeNode(e.node.id),!1}function Le(t,e,l,u){if(t.key==="`"&&!v(e)){t.preventDefault(),x.updateNode(l.node.id,l.node.text,void 0,"deletion");return}t.key==="Enter"&&(t.ctrlKey?u(new MouseEvent("click",{ctrlKey:!0})):D(e,!0)),t.key==="Delete"&&t.ctrlKey&&x.removeNode(l.node.id)}var Te=K('<div class="correction-wrapper svelte-1ds3l31"><div class="correction-text svelte-1ds3l31"> </div> <div class="text-content svelte-1ds3l31"> </div></div>'),De=K('<div class="text-content deleted svelte-1ds3l31"> </div>'),Ke=K('<div class="text-content svelte-1ds3l31">+</div>'),Ae=K('<div class="text-content svelte-1ds3l31"> </div>'),Ue=K('<div role="button" tabindex="0"><!></div> <!>',1);function Pe(t,e){G(e,!0);const[l,u]=ee(),w=()=>H(te,"$hoveredNodeType",l),n=Z(e,"isActive",3,!1);let a=z(!1),o=z(!1);function r(_){if(_.button===0){if(_.ctrlKey){x.insertNodeAfter(e.node.id,"","empty");return}if(_.altKey){if(e.node.type==="empty")return;e.node.type==="deletion"?x.updateNode(e.node.id,e.node.text,void 0,"normal"):x.updateNode(e.node.id,e.node.text,void 0,"deletion");return}if(e.node.type==="deletion"){x.updateNode(e.node.id,e.node.text,void 0,"normal");return}x.setActiveNode(e.node.id),n()&&D(a,!0)}}function i(){D(o,!0),setTimeout(()=>{D(o,!1)},300)}function d(){D(a,!1),x.setActiveNode(null),i()}let b=W(()=>["text-node",e.node.type,n()?"active":"",e.node.hasNextCorrection?"has-next-correction":"",v(a)?"highlighted":"",e.node.isPunctuation?"punctuation":"",v(o)?"saved-flash":"",w()===e.node.type?`highlight-${e.node.type}`:""].filter(Boolean).join(" "));var h=Ue(),y=V(h);y.__click=r,y.__contextmenu=[Ee,e],y.__keydown=[Le,a,e,r];var g=f(y);{var S=_=>{var E=Te(),c=f(E),A=f(c,!0);m(c);var P=I(c,2),N=f(P,!0);m(P),m(E),R(()=>{T(A,e.node.correctionText),T(N,e.node.text)}),C(_,E)},s=_=>{var E=Q(),c=V(E);{var A=N=>{var L=De(),B=f(L,!0);m(L),R(()=>T(B,e.node.text)),C(N,L)},P=N=>{var L=Q(),B=V(L);{var ne=M=>{var j=Ke();C(M,j)},oe=M=>{var j=Ae(),ae=f(j,!0);m(j),R(()=>T(ae,e.node.text)),C(M,j)};q(B,M=>{e.node.type==="empty"?M(ne):M(oe,!1)},!0)}C(N,L)};q(c,N=>{e.node.type==="deletion"?N(A):N(P,!1)},!0)}C(_,E)};q(g,_=>{e.node.type==="correction"?_(S):_(s,!1)})}m(y);var p=I(y,2);{var k=_=>{Ie(_,{get node(){return e.node},onClose:d})};q(p,_=>{v(a)&&_(k)})}R(()=>he(y,ye(v(b)),"svelte-1ds3l31")),C(t,h),O(),u()}Y(["click","contextmenu","keydown"]);var Me=(t,e)=>e(t,"correction"),Re=(t,e)=>e(t,"deletion"),We=(t,e)=>e(t,"addition"),Be=K('<div class="stats-container print-hide svelte-1m8riwo" role="complementary" aria-label="Document statistics"><div class="stat svelte-1m8riwo"><span class="label svelte-1m8riwo">Total:</span> <span class="value svelte-1m8riwo"> </span></div> <div class="stat svelte-1m8riwo" role="button" tabindex="0" aria-label="Show correction annotations"><span class="label svelte-1m8riwo">Corrections:</span> <span class="value svelte-1m8riwo"> </span></div> <div class="stat svelte-1m8riwo" role="button" tabindex="0" aria-label="Show deletion annotations"><span class="label svelte-1m8riwo">Deletions:</span> <span class="value svelte-1m8riwo"> </span></div> <div class="stat svelte-1m8riwo" role="button" tabindex="0" aria-label="Show addition annotations"><span class="label svelte-1m8riwo">Additions:</span> <span class="value svelte-1m8riwo"> </span></div></div>');function je(t,e){G(e,!0);const[l,u]=ee();let n=W(()=>H(pe,"$statsStore",l));function a(c){te.set(c)}function o(c,A){(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),a(A))}var r=Be(),i=f(r),d=I(f(i),2),b=f(d,!0);m(d),m(i);var h=I(i,2);h.__keydown=[Me,o];var y=I(f(h),2),g=f(y,!0);m(y),m(h);var S=I(h,2);S.__keydown=[Re,o];var s=I(f(S),2),p=f(s,!0);m(s),m(S);var k=I(S,2);k.__keydown=[We,o];var _=I(f(k),2),E=f(_,!0);m(_),m(k),m(r),R(()=>{T(b,v(n).total),T(g,v(n).corrections),T(p,v(n).deletions),T(E,v(n).additions)}),U("mouseenter",h,()=>a("correction")),U("mouseleave",h,()=>a(null)),U("mouseenter",S,()=>a("deletion")),U("mouseleave",S,()=>a(null)),U("mouseenter",k,()=>a("addition")),U("mouseleave",k,()=>a(null)),C(t,r),O(),u()}Y(["keydown"]);var qe=K('<div class="editor-wrapper svelte-1o51am7" tabindex="-1" aria-multiline="true" aria-label="Text editor content" role="textbox"><!> <div class="main-content svelte-1o51am7"><div class="preview-container svelte-1o51am7" role="complementary" aria-label="Preview"><div class="a4-content svelte-1o51am7"> <div class="line-row svelte-1o51am7"><!></div></div></div></div></div>');function ze(t,e){G(e,!0);const[l,u]=ee(),w=()=>H(x,"$editorStore",l),n=()=>H(be,"$sidebarStore",l),a=Z(e,"initialContent",3,""),o=Z(e,"onContentChange",3,c=>{});let r=W(()=>w().nodeList),i=W(()=>w().activeNodeId),d=W(()=>x.getContent());X(()=>{a()&&!v(d)&&x.parseContent(a())}),X(()=>{v(d)!==a()&&o()(v(d))});function b(c){c.ctrlKey&&c.key==="z"&&!c.shiftKey?(c.preventDefault(),x.undo()):c.ctrlKey&&c.key==="y"&&(c.preventDefault(),x.redo())}var h=qe();h.__keydown=b;var y=f(h);je(y,{});var g=I(y,2),S=f(g),s=f(S),p=f(s),k=I(p),_=f(k);{var E=c=>{var A=Q(),P=V(A);we(P,17,()=>v(r)[0].nodes,N=>N.id,(N,L)=>{const B=W(()=>v(L).id===v(i));Pe(N,{get node(){return v(L)},get isActive(){return v(B)}})}),C(c,A)};q(_,c=>{v(r).length>0&&c(E)})}m(k),m(s),m(S),m(g),m(h),R(c=>{_e(g,"sidebar-expanded",n().isOpen),T(p,`${c??""} `)},[()=>console.log(v(r))]),C(t,h),O(),u()}Y(["keydown"]);var Ge=K('<div class="app-container svelte-15pewon"><!></div>');function Xe(t,e){G(e,!1);const l="Me and my friend go to school in Busan.  We learn many thing, like English and math.  Sometimes, English is very difficult, but I try my bestest.  After school, we play soccer and eat kimchi with my family.";let u=!1;const w=i=>{if(u)return i.preventDefault(),""},n=i=>{u&&!window.confirm("You have unsaved changes. Are you sure you want to leave?")&&(i.preventDefault(),history.pushState(null,"",window.location.href))};fe(()=>(window.addEventListener("beforeunload",w),window.addEventListener("popstate",n),history.pushState(null,"",window.location.href),()=>{window.removeEventListener("beforeunload",w),window.removeEventListener("popstate",n)}));function a(i){u=i!==l}de();var o=Ge(),r=f(o);ze(r,{initialContent:l,onContentChange:a}),m(o),C(t,o),O()}export{Xe as component};
