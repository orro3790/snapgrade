import{a as w,t as T,c as J,d as we}from"../chunks/D-InZ17l.js";import"../chunks/D5VImn6m.js";import{k as ie,m as oe,p as Ie,q as ee,I as Ce,b as be,h as C,y as Q,z as Ee,N as m,a5 as Te,a6 as se,x as X,g as K,a7 as he,d as xe,a8 as Ae,at as Z,F as ge,au as De,av as Re,D as Le,aw as Me,f as Ue,t as Pe,ao as qe,A as Ke,ac as ze,_ as le,ax as Oe,ay as Be,az as He,v as Ve,o as We,aA as Ye,aB as Fe,aC as Ge,a as Je,aa as Qe,J as ne,as as V,u as Y,S as b,T as I,K as ae,a0 as R,i as z,U as de,R as P,Q as H}from"../chunks/BhiJXt1a.js";import{a as Xe,b as Ze,p as te,i as O,s as je,c as ce}from"../chunks/CZv6OFoK.js";import{g as $e,w as me}from"../chunks/BVT5AGqx.js";import{d as re,s as B}from"../chunks/CCwlP9Ry.js";let fe=!1;function ye(){fe||(fe=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function et(t){var e=Ie,n=ee;ie(null),oe(null);try{return t()}finally{ie(e),oe(n)}}function tt(t,e,n,i=n){t.addEventListener(e,()=>et(n));const l=t.__on_r;l?t.__on_r=()=>{l(),i(!0)}:t.__on_r=()=>i(!0),ye()}function nt(t,e,n,i){for(var l=[],r=e.length,s=0;s<r;s++)Re(e[s].e,l,!0);var o=r>0&&l.length===0&&n!==null;if(o){var u=n.parentNode;Le(u),u.append(n),i.clear(),D(t,e[0].prev,e[r-1].next)}Me(l,()=>{for(var c=0;c<r;c++){var a=e[c];o||(i.delete(a.k),D(t,a.prev,a.next)),Ue(a.e,!o)}})}function ue(t,e,n,i,l,r=null){var s=t,o={flags:e,items:new Map,first:null};{var u=t;s=C?Q(Pe(u)):u.appendChild(Ce())}C&&Ee();var c=null,a=!1,g=qe(()=>{var f=n();return We(f)?f:f==null?[]:ge(f)});be(()=>{var f=m(g),h=f.length;if(a&&h===0)return;a=h===0;let v=!1;if(C){var y=s.data===Te;y!==(h===0)&&(s=se(),Q(s),X(!1),v=!0)}if(C){for(var d=null,_,x=0;x<h;x++){if(K.nodeType===8&&K.data===Ke){s=K,v=!0,X(!1);break}var S=f[x],N=i(S,x);_=pe(K,o,d,null,S,N,x,l,e,n),o.items.set(N,_),d=_}h>0&&Q(se())}C||at(f,o,s,l,e,i,n),r!==null&&(h===0?c?he(c):c=xe(()=>r(s)):c!==null&&Ae(c,()=>{c=null})),v&&X(!0),m(g)}),C&&(s=K)}function at(t,e,n,i,l,r,s){var o=t.length,u=e.items,c=e.first,a=c,g,f=null,h=[],v=[],y,d,_,x;for(x=0;x<o;x+=1){if(y=t[x],d=r(y,x),_=u.get(d),_===void 0){var S=a?a.e.nodes_start:n;f=pe(S,e,f,f===null?e.first:f.next,y,d,x,i,l,s),u.set(d,f),h=[],v=[],a=f.next;continue}if(rt(_,y,x),_.e.f&Z&&he(_.e),_!==a){if(g!==void 0&&g.has(_)){if(h.length<v.length){var N=v[0],k;f=N.prev;var E=h[0],L=h[h.length-1];for(k=0;k<h.length;k+=1)ve(h[k],N,n);for(k=0;k<v.length;k+=1)g.delete(v[k]);D(e,E.prev,L.next),D(e,f,E),D(e,L,N),a=N,f=L,x-=1,h=[],v=[]}else g.delete(_),ve(_,a,n),D(e,_.prev,_.next),D(e,_,f===null?e.first:f.next),D(e,f,_),f=_;continue}for(h=[],v=[];a!==null&&a.k!==d;)a.e.f&Z||(g??(g=new Set)).add(a),v.push(a),a=a.next;if(a===null)continue;_=a}h.push(_),f=_,a=_.next}if(a!==null||g!==void 0){for(var q=g===void 0?[]:ge(g);a!==null;)a.e.f&Z||q.push(a),a=a.next;var F=q.length;if(F>0){var A=o===0?n:null;nt(e,q,A,u)}}ee.first=e.first&&e.first.e,ee.last=f&&f.e}function rt(t,e,n,i){De(t.v,e),t.i=n}function pe(t,e,n,i,l,r,s,o,u,c){var a=(u&Be)!==0,g=(u&He)===0,f=a?g?ze(l):le(l):l,h=u&Oe?le(s):s,v={i:h,v:f,k:r,a:null,e:null,prev:n,next:i};try{return v.e=xe(()=>o(t,f,h,c),C),v.e.prev=n&&n.e,v.e.next=i&&i.e,n===null?e.first=v:(n.next=v,n.e.next=v.e),i!==null&&(i.prev=v,i.e.prev=v.e),v}finally{}}function ve(t,e,n){for(var i=t.next?t.next.e.nodes_start:n,l=e?e.e.nodes_start:n,r=t.e.nodes_start;r!==i;){var s=Ve(r);l.before(r),r=s}}function D(t,e,n){e===null?t.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function ke(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var l=t.length;for(e=0;e<l;e++)t[e]&&(n=ke(t[e]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function it(){for(var t,e,n=0,i="",l=arguments.length;n<l;n++)(t=arguments[n])&&(e=ke(t))&&(i&&(i+=" "),i+=e);return i}function ot(t){return typeof t=="object"?it(t):t??""}function st(t){if(C){var e=!1,n=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var i=t.value;_e(t,"value",null),t.value=i}if(t.hasAttribute("checked")){var l=t.checked;_e(t,"checked",null),t.checked=l}}};t.__on_r=n,Ye(n),ye()}}function _e(t,e,n,i){var l=t.__attributes??(t.__attributes={});C&&(l[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||l[e]!==(l[e]=n)&&(e==="style"&&"__styles"in t&&(t.__styles={}),e==="loading"&&(t[Fe]=n),t.removeAttribute(e))}function lt(t,e,n){var i=t.__className,l=dt(e,n);C&&t.className===l?t.__className=l:(i!==l||C&&t.className!==l)&&(t.className=l,t.__className=l)}function dt(t,e){return(t??"")+(" "+e)}function ct(t,e,n){if(n){if(t.classList.contains(e))return;t.classList.add(e)}else{if(!t.classList.contains(e))return;t.classList.remove(e)}}function ft(t,e,n=e){var i=Ge();tt(t,"input",l=>{var r=l?t.defaultValue:t.value;if(r=j(t)?$(r):r,n(r),i&&r!==(r=e())){var s=t.selectionStart,o=t.selectionEnd;t.value=r??"",o!==null&&(t.selectionStart=s,t.selectionEnd=Math.min(o,t.value.length))}}),(C&&t.defaultValue!==t.value||Je(e)==null&&t.value)&&n(j(t)?$(t.value):t.value),Qe(()=>{var l=e();j(t)&&l===$(t.value)||t.type==="date"&&!l&&!t.value||l!==t.value&&(t.value=l??"")})}function j(t){var e=t.type;return e==="number"||e==="range"}function $(t){return t===""?null:+t}function ut(){const{subscribe:t,update:e}=me({paragraphs:[],activeNodeId:null,undoStack:[],redoStack:[],isSaving:!1,lastSavedContent:"",initialState:null});function n(r){return{...r,undoStack:[...r.undoStack,r.paragraphs],redoStack:[]}}function i(r,s){const o=[];let u=s;const c=[];let a;const g=/(\S+)\s+!([^!]+)!/g;for(;(a=g.exec(r))!==null;)c.push({type:"correction",text:a[1],correction:a[2],index:a.index,length:a[0].length});const f=/-([^-]+)-/g;for(;(a=f.exec(r))!==null;)c.push({type:"deletion",text:a[1],index:a.index,length:a[0].length});const h=/\[([^\]]+)\]/g;for(;(a=h.exec(r))!==null;)c.push({type:"addition",text:a[1],index:a.index,length:a[0].length});c.sort((d,_)=>d.index-_.index);let v=0;const y=d=>{const _=d.split(/(\s+)|([.,!?;:])/).filter(Boolean);for(const x of _)if(/^\s+$/.test(x))u+=x.length;else{const S=/^[.,!?;:]$/.test(x);o.push({id:crypto.randomUUID(),text:x,type:"normal",startIndex:u,endIndex:u+x.length,isPunctuation:S,mispunctuation:!1}),u+=x.length}};for(const d of c){if(d.index>v){const x=r.slice(v,d.index);y(x)}const _={id:crypto.randomUUID(),text:d.text,type:d.type,startIndex:u,endIndex:u+d.text.length,isPunctuation:!1};d.type==="correction"&&d.correction&&(_.correctionText=d.correction,_.hasNextCorrection=!1),o.push(_),u+=d.length,v=d.index+d.length}if(v<r.length){const d=r.slice(v);y(d)}for(let d=0;d<o.length-1;d++)o[d].type==="correction"&&o[d+1].type==="correction"&&(o[d].hasNextCorrection=!0),o[d].type==="correction"&&o[d+1].isPunctuation&&(o[d].hasNextCorrection=!0);return o}return{subscribe:t,parseContent:r=>{const s=r.split(`

`).map((o,u)=>({id:crypto.randomUUID(),nodes:i(o,u*1e3),originalText:o}));e(o=>({...o,paragraphs:s,lastSavedContent:r,initialState:o.initialState===null?s:o.initialState}))},insertNodeAfter:(r,s,o="normal")=>{e(u=>{const c=n(u);let a=-1;const g=u.paragraphs.find(v=>(a=v.nodes.findIndex(y=>y.id===r),a!==-1));if(!g||a===-1)return u;const f={id:crypto.randomUUID(),text:s,type:o,startIndex:g.nodes[a].endIndex+1,endIndex:g.nodes[a].endIndex+1+s.length,isPunctuation:!1},h=u.paragraphs.map(v=>{if(v.id===g.id){const y=[...v.nodes];return y.splice(a+1,0,f),{...v,nodes:y}}return v});return{...c,paragraphs:h,activeNodeId:f.id}})},removeNode:r=>{e(s=>{const o=n(s),u=s.paragraphs.map(c=>({...c,nodes:c.nodes.filter(a=>a.id!==r)}));return{...o,paragraphs:u,activeNodeId:null}})},updateNode:(r,s,o,u)=>{e(c=>{const a=n(c),g=c.paragraphs.map(f=>({...f,nodes:f.nodes.map(h=>h.id===r?{...h,text:s,type:u||h.type,...o!==void 0&&{correctionText:o}}:h)}));return{...a,paragraphs:g}})},setActiveNode:r=>{e(s=>({...s,activeNodeId:r}))},undo:()=>{e(r=>{if(r.undoStack.length===0)return r;const s=[...r.undoStack],o=s.pop();return{...r,paragraphs:o,undoStack:s,redoStack:[...r.redoStack,r.paragraphs]}})},redo:()=>{e(r=>{if(r.redoStack.length===0)return r;const s=[...r.redoStack],o=s.pop();return{...r,paragraphs:o,undoStack:[...r.undoStack,r.paragraphs],redoStack:s}})},getContent:()=>$e({subscribe:t}).paragraphs.map(s=>s.nodes.map(o=>{switch(o.type){case"deletion":return`-${o.text}-`;case"addition":return`[${o.text}]`;case"correction":return`${o.text} !${o.correctionText}!`;default:return o.text}}).join(" ")).join(`

`)}}const p=ut(),vt=me({isOpen:!0});function _t(t,e,n){t.key==="Enter"?(t.preventDefault(),e()):t.key==="Escape"&&n.onClose()}function ht(t,e){t.target===t.currentTarget&&e()}var xt=T('<div class="modal-overlay svelte-bxhfdp" role="dialog" aria-modal="true"><div class="modal-content svelte-bxhfdp"><input class="edit-input svelte-bxhfdp" aria-label="Edit text"></div></div>');function gt(t,e){ne(e,!0);let n=V(Xe(e.node.text)),i=V(void 0),l=V(!1);Y(()=>{m(i)&&(m(i).focus(),m(i).select())});function r(){if(m(l))return;R(l,!0);const c=m(n).trim();if(e.node.type==="empty"){c?p.updateNode(e.node.id,c,void 0,"addition"):p.removeNode(e.node.id),e.onClose();return}if(!c){p.updateNode(e.node.id,e.node.text,void 0,"normal"),e.onClose();return}if(c.startsWith("`"))p.updateNode(e.node.id,e.node.text,void 0,"deletion");else if(c.startsWith("@")){const a=c.slice(1);a&&(p.updateNode(e.node.id,e.node.text),p.insertNodeAfter(e.node.id,a))}else if(c.startsWith("!")){const a=c.slice(1);p.updateNode(e.node.id,a)}else p.updateNode(e.node.id,e.node.text,c,"correction");e.onClose()}var s=xt();s.__click=[ht,r];var o=b(s),u=b(o);st(u),u.__keydown=[_t,r,e],Ze(u,c=>R(i,c),()=>m(i)),I(o),I(s),ft(u,()=>m(n),c=>R(n,c)),w(t,s),ae()}re(["click","keydown"]);function mt(t,e){t.preventDefault(),t.ctrlKey&&p.removeNode(e.node.id)}function yt(t,e,n,i){if(t.key==="`"&&!m(e)){t.preventDefault(),p.updateNode(n.node.id,n.node.text,void 0,"deletion");return}t.key==="Enter"&&(t.ctrlKey?i(new MouseEvent("click",{ctrlKey:!0})):R(e,!0)),t.key==="Delete"&&t.ctrlKey&&p.removeNode(n.node.id)}var pt=T('<span class="correction-text svelte-1qxtlmk"> </span> <span class="underlined svelte-1qxtlmk"> </span>',1),kt=T('<span class="deleted svelte-1qxtlmk"> </span>'),Nt=T('<span class="added svelte-1qxtlmk"> </span>'),St=T('<span class="empty-placeholder svelte-1qxtlmk">+</span>'),wt=T('<span role="button" tabindex="0"><!></span> <!>',1);function It(t,e){ne(e,!0);const n=te(e,"isActive",3,!1);let i=V(!1),l=V(!1);function r(d){if(d.ctrlKey&&!d.button){p.insertNodeAfter(e.node.id,"","empty");return}if(e.node.type==="deletion"){p.updateNode(e.node.id,e.node.text,void 0,"normal");return}p.setActiveNode(e.node.id),n()&&R(i,!0)}function s(){R(l,!0),setTimeout(()=>{R(l,!1)},300)}function o(){R(i,!1),p.setActiveNode(null),s()}let u=H(()=>["text-node",e.node.type,n()?"active":"",e.node.hasNextCorrection?"has-next-correction":"",m(i)?"highlighted":"",e.node.isPunctuation?"punctuation":"",e.node.mispunctuation?"mispunctuation":"",m(l)?"saved-flash":""].filter(Boolean).join(" "));var c=wt(),a=z(c);a.__click=r,a.__contextmenu=[mt,e],a.__keydown=[yt,i,e,r];var g=b(a);{var f=d=>{var _=pt(),x=z(_),S=b(x,!0);I(x);var N=de(x,2),k=b(N,!0);I(N),P(()=>{B(S,e.node.correctionText),B(k,e.node.text)}),w(d,_)},h=d=>{var _=J(),x=z(_);{var S=k=>{var E=kt(),L=b(E,!0);I(E),P(()=>B(L,e.node.text)),w(k,E)},N=k=>{var E=J(),L=z(E);{var q=A=>{var M=Nt(),G=b(M,!0);I(M),P(()=>B(G,e.node.text)),w(A,M)},F=A=>{var M=J(),G=z(M);{var Ne=U=>{var W=St();w(U,W)},Se=U=>{var W=we();P(()=>B(W,e.node.text||"")),w(U,W)};O(G,U=>{e.node.type==="empty"?U(Ne):U(Se,!1)},!0)}w(A,M)};O(L,A=>{e.node.type==="addition"?A(q):A(F,!1)},!0)}w(k,E)};O(x,k=>{e.node.type==="deletion"?k(S):k(N,!1)},!0)}w(d,_)};O(g,d=>{e.node.type==="correction"?d(f):d(h,!1)})}I(a);var v=de(a,2);{var y=d=>{gt(d,{get node(){return e.node},onClose:o})};O(v,d=>{m(i)&&d(y)})}P(()=>lt(a,ot(m(u)),"svelte-1qxtlmk")),w(t,c),ae()}re(["click","contextmenu","keydown"]);re(["click","keydown"]);var Ct=T('<div class="paragraph svelte-zeeeo7"></div>'),bt=T('<div class="editor-wrapper svelte-zeeeo7"><div class="main-content svelte-zeeeo7"><div class="preview-container svelte-zeeeo7" role="complementary" aria-label="Preview"><div class="a4-content svelte-zeeeo7"></div></div></div></div>');function Et(t,e){ne(e,!0);const[n,i]=je(),l=()=>ce(p,"$editorStore",n),r=()=>ce(vt,"$sidebarStore",n),s=te(e,"initialContent",3,""),o=te(e,"onContentChange",3,y=>{});let u=H(()=>l().paragraphs),c=H(()=>l().activeNodeId),a=H(()=>p.getContent());Y(()=>{s()&&!m(a)&&p.parseContent(s())}),Y(()=>{m(a)!==s()&&o()(m(a))}),Y(()=>{p.getContent(),l().lastSavedContent});var g=bt(),f=b(g),h=b(f),v=b(h);ue(v,21,()=>m(u),y=>y.id,(y,d)=>{var _=Ct();ue(_,21,()=>m(d).nodes,x=>x.id,(x,S)=>{const N=H(()=>m(S).id===m(c));It(x,{get node(){return m(S)},get isActive(){return m(N)}})}),I(_),w(y,_)}),I(v),I(h),I(f),I(g),P(()=>ct(f,"sidebar-expanded",r().isOpen)),w(t,g),ae(),i()}var Tt=T('<div class="app-container svelte-15pewon"><!></div>');function Pt(t){const e="Me and my friend go to school in Busan.  We learn many thing, like English and math.  Sometimes, English is very difficult, but I try my bestest.  After school, we play soccer and eat kimchi with my family.";var n=Tt(),i=b(n);Et(i,{initialContent:e}),I(n),w(t,n)}export{Pt as component};
