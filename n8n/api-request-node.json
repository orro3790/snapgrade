{
	"nodes": [
		{
			"parameters": {
				"method": "POST",
				"url": "={{ $env.SNAPGRADE_API_URL }}/api/documents/process",
				"sendBody": true,
				"specifyBody": "json",
				"jsonBody": "={{\n  \"image\": $binary.data.base64,\n  \"text\": $json.data,\n  \"uid\": $('Set User Data').item.json.userId\n}}",
				"options": {
					"redirect": {
						"redirect": {
							"followRedirects": true
						}
					}
				}
			},
			"name": "Send to Snapgrade API",
			"type": "n8n-nodes-base.httpRequest",
			"typeVersion": 4.1,
			"position": [1700, 420]
		},
		{
			"parameters": {
				"conditions": {
					"boolean": [
						{
							"value1": "={{ $json.status }}",
							"value2": 200,
							"operation": "equal"
						}
					]
				}
			},
			"name": "Check API Response",
			"type": "n8n-nodes-base.if",
			"typeVersion": 1,
			"position": [1900, 420]
		},
		{
			"parameters": {
				"chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
				"text": "=✅ Document processed!\n\nView it here: https://snapgrade.app/documents/{{ $json.body.documentId }}\n\nStudent: {{ $('Set User Data').item.json.studentName }}\nClass: {{ $('Set User Data').item.json.className }}",
				"additionalFields": {
					"parse_mode": "HTML"
				}
			},
			"name": "Send Success Message",
			"type": "n8n-nodes-base.telegram",
			"typeVersion": 1.2,
			"position": [2100, 320],
			"credentials": {
				"telegramApi": {
					"id": "YOUR_TELEGRAM_CRED_ID",
					"name": "Telegram account"
				}
			}
		},
		{
			"parameters": {
				"chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
				"text": "=❌ Error processing document.\n\nError: {{ $json.body.error || 'Unknown error' }}",
				"additionalFields": {
					"parse_mode": "HTML"
				}
			},
			"name": "Send Error Message",
			"type": "n8n-nodes-base.telegram",
			"typeVersion": 1.2,
			"position": [2100, 520],
			"credentials": {
				"telegramApi": {
					"id": "YOUR_TELEGRAM_CRED_ID",
					"name": "Telegram account"
				}
			}
		}
	],
	"connections": {
		"LLMWhisperer: Retrieve Extracted Text": {
			"main": [
				[
					{
						"node": "Send to Snapgrade API",
						"type": "main",
						"index": 0
					}
				]
			]
		},
		"Send to Snapgrade API": {
			"main": [
				[
					{
						"node": "Check API Response",
						"type": "main",
						"index": 0
					}
				]
			]
		},
		"Check API Response": {
			"main": [
				[
					{
						"node": "Send Success Message",
						"type": "main",
						"index": 0
					}
				],
				[
					{
						"node": "Send Error Message",
						"type": "main",
						"index": 0
					}
				]
			]
		}
	}
}
